{"version":3,"file":"svgraph.js","sources":["../src/util/svg.ts","../src/util/html.ts","../src/util/range.ts","../src/util/util.ts","../src/popup.ts","../src/legend.ts","../src/label.ts","../src/labeltypes/empty.ts","../src/labeltypes/number.ts","../src/labeltypes/integer.ts","../src/labeltypes/date.ts","../src/labeltypes/time.ts","../src/labeltypes/metric.ts","../src/svgraph.ts"],"sourcesContent":["const ns = \"http://www.w3.org/2000/svg\"\r\n\r\nfunction element(name: string, attrs: { [key: string]: any }, children: Node[] = []): SVGElement {\r\n\tconst elem = document.createElementNS(ns, name)\r\n\tfor (const key in attrs) {\r\n\t\tif (attrs[key] !== undefined) elem.setAttribute(key, attrs[key])\r\n\t}\r\n\tfor (const child of children ?? []) elem.appendChild(child)\r\n\treturn elem\r\n}\r\n\r\ntype stringable = string | number | boolean\r\n\r\ntype DefaultAttrs = {\r\n\tid?: string\r\n\tclass?: string\r\n\tstyle?: string\r\n\ttransform?: string\r\n\tfill?: string\r\n\tstroke?: string\r\n\t\"stroke-width\"?: stringable\r\n\t\"font-size\"?: stringable\r\n\tvisibility?: \"visible\" | \"hidden\"\r\n\t[_: `data-${string}`]: string\r\n}\r\n\r\nexport const svg = (attrs: { width: string, height: string, viewBox?: string, preserveAspectRatio?: string, overflow?: string } & DefaultAttrs, ...children: Node[]) =>\r\n\telement(\"svg\", { ...attrs, xmlns: ns }, children) as SVGElement\r\n\r\nexport const circle = (attrs: { cx: stringable, cy: stringable, r: stringable } & DefaultAttrs, ...children: Node[]) =>\r\n\telement(\"circle\", attrs, children) as SVGCircleElement\r\n\r\nexport const g = (attrs: DefaultAttrs = {}, ...children: Node[]) => element(\"g\", attrs, children) as SVGGElement\r\n\r\nexport const line = (attrs: { from: [stringable, stringable], to: [stringable, stringable] } & DefaultAttrs, ...children: Node[]) =>\r\n\telement(\"line\", { ...attrs, x1: attrs.from[0], y1: attrs.from[1], x2: attrs.to[0], y2: attrs.to[1], from: undefined, to: undefined }, children) as SVGLineElement\r\n\r\nexport const polyline = (attrs: { points: [number, number][] } & DefaultAttrs, ...children: Node[]) =>\r\n\telement(\"polyline\", { ...attrs, points: attrs.points.map(([x, y]) => `${x},${y}`).join(\" \") }, children) as SVGPolylineElement\r\n\r\nexport const rect = (attrs: { x?: stringable, y?: stringable, width: stringable, height: stringable, rx?: stringable, ry?: stringable } & DefaultAttrs, ...children: Node[]) =>\r\n\telement(\"rect\", attrs, children) as SVGRectElement\r\n\r\nexport const text = (attrs: { x: stringable, y: stringable, dx?: stringable, dy?: stringable, rotate?: number[], lengthAdjust?: string, textLength?: stringable, \"text-anchor\"?: \"start\" | \"middle\" | \"end\" } & DefaultAttrs, ...children: Node[]) =>\r\n\telement(\"text\", attrs, children) as SVGTextElement\r\n","function element(name: string, attrs: { [key: string]: any }, children: Node[] = []): HTMLElement {\r\n\tconst elem = document.createElement(name)\r\n\tfor (const key in attrs) {\r\n\t\tif (attrs[key] !== undefined) elem.setAttribute(key, attrs[key])\r\n\t}\r\n\tfor (const child of children ?? []) elem.appendChild(child)\r\n\treturn elem\r\n}\r\n\r\ntype DefaultAttrs = {\r\n\tid?: string\r\n\tclass?: string\r\n\tstyle?: string\r\n\thidden?: string\r\n\t[_: `data-${string}`]: string\r\n}\r\n\r\nexport const div = (attrs: DefaultAttrs = {}, ...children: Node[]) => element(\"div\", attrs, children)\r\nexport const p = (attrs: DefaultAttrs = {}, ...children: Node[]) => element(\"p\", attrs, children)\r\nexport const span = (attrs: DefaultAttrs = {}, ...children: Node[]) => element(\"span\", attrs, children)\r\nexport const h1 = (attrs: DefaultAttrs = {}, ...children: Node[]) => element(\"h1\", attrs, children)\r\nexport const h2 = (attrs: DefaultAttrs = {}, ...children: Node[]) => element(\"h2\", attrs, children)\r\nexport const h3 = (attrs: DefaultAttrs = {}, ...children: Node[]) => element(\"h3\", attrs, children)\r\n","import { Value } from \"./util\"\r\n\r\nexport default class Range<T extends Value> {\r\n\tconstructor(public min: T, public max: T) { }\r\n\r\n\t/**\r\n\t * The unit range [0,1]\r\n\t */\r\n\tstatic UNIT = new Range(0, 1) as Range<number>\r\n\r\n\t/**\r\n\t * The span of this range, i.e. `max - min`\r\n\t */\r\n\tget span() { return this.max.valueOf() - this.min.valueOf() }\r\n\r\n\t/**\r\n\t * Returns whether a value is within this range\r\n\t */\r\n\tcontains = <U extends T>(value: U): boolean => this.min.valueOf() < value.valueOf() && value.valueOf() < this.max.valueOf()\r\n\r\n\t/**\r\n\t * Clamps a value to this range\r\n\t */\r\n\tclamp = <U extends T>(value: U): number => Math.max(this.min.valueOf(), Math.min(value.valueOf(), this.max.valueOf()))\r\n\r\n\t/**\r\n\t * Normalizes a value in this range to [0,1]\r\n\t */\r\n\tnormalize = <U extends T>(value: U): number => (this.span != 0) ? (value.valueOf() - this.min.valueOf()) / this.span : 0\r\n\r\n\t/**\r\n\t * Interpolates a `t` in [0,1] to this range\r\n\t */\r\n\tlerp = (t: number): number => this.min.valueOf() + t * this.span\r\n}\r\n","import Range from \"./range\"\nimport { Label } from \"../label\"\nimport { Point } from \"../svgraph\"\n\nexport type DeepPartial<T> = T extends object\n\t? { [P in keyof T]?: DeepPartial<T[P]> }\n\t: T\n\n/**\n * Any value that can be interpreted as a number.\n * \n * This automatically includes the native `number` type.\n */\nexport type Value = { valueOf(): number }\n\nexport const maxBy = <T>(arr: T[], fn: (x: T) => number): T => (arr.length > 0) ? arr.reduce((a, b) => fn(a) > fn(b) ? a : b) : undefined\nexport const maxByKey = <T>(arr: T[], key: keyof T): T => (arr.length > 0) ? arr.reduce((a, b) => a[key] > b[key] ? a : b) : undefined\n\nexport const minBy = <T>(arr: T[], fn: (x: T) => number): T => (arr.length > 0) ? arr.reduce((a, b) => fn(a) < fn(b) ? a : b) : undefined\nexport const minByKey = <T>(arr: T[], key: keyof T): T => (arr.length > 0) ? arr.reduce((a, b) => a[key] < b[key] ? a : b) : undefined\n\nexport const floorTo = (n: number, to: number) => Math.floor(n / to) * to\n\nconst nearestIdx = (arr: number[], to: number): number =>\n\tminByKey(arr.map((x, idx) => [Math.abs(x - to), idx]), 0)[1]\n\nexport function nearestLabel(t: number, range: Range<Label>, data: { name: string, points: Point[] }[]) {\n\tconst nearestLabelsIdx = data.map(({ points }) => nearestIdx(points.map(p => range.normalize(p.label)), t))\n\tconst nearestLabels = nearestLabelsIdx.map((closestIdx, i) => data[i].points[closestIdx].label)\n\treturn minBy(nearestLabels, l => Math.abs(range.normalize(l) - t))\n}\n","import { div, h3, p, span } from \"./util/html\"\r\nimport Range from \"./util/range\"\r\nimport { minByKey, nearestLabel } from \"./util/util\"\r\nimport { Point } from \"./svgraph\"\r\nimport { Label } from \"./label\"\r\n\r\nconst nearestPointForLabel = (arr: Point[], to: Label, range: Range<Label>): Point =>\r\n\tminByKey(arr.map(x => [x, Math.abs(range.normalize(x.label) - range.normalize(to))]) as [Point, number][], 1)[0]\r\n\r\nexport default class PopupElement extends HTMLElement {\r\n\tconstructor() {\r\n\t\tsuper()\r\n\t\tthis.setAttribute(\"hidden\", \"\")\r\n\t}\r\n\r\n\tshow() { this.removeAttribute(\"hidden\") }\r\n\r\n\thide() { this.setAttribute(\"hidden\", \"\") }\r\n\r\n\tmove(x: number, y: number) {\r\n\t\tthis.style.left = `${x + 20}px`\r\n\t\tthis.style.top = `${y}px`\r\n\t}\r\n\r\n\tupdate(x: number, y: number, t: number, range: Range<Label>, data: { name: string, colour: string, points: Point[] }[]): Point[] {\r\n\t\tthis.move(x, y)\r\n\r\n\t\tconst label = nearestLabel(t, range, data)\r\n\r\n\t\tthis.innerHTML = \"\"\r\n\t\tthis.appendChild(h3({}, new Text(label?.text)))\r\n\r\n\t\tconst nearestPoints = data.map(({ name, colour, points }) => ({ name, colour, point: nearestPointForLabel(points, label, range) }))\r\n\t\tthis.setValues(nearestPoints)\r\n\r\n\t\tthis.show()\r\n\r\n\t\treturn nearestPoints.map(x => x.point)\r\n\t}\r\n\r\n\tprivate setValues(points: { name: string, colour: string, point: Point }[]) {\r\n\t\tfor (const { name, colour, point: { value } } of points) {\r\n\t\t\tif (value != undefined && value.valueOf() != 0) this.appendChild(p({},\r\n\t\t\t\tdiv({ class: \"swatch\", style: `background-color: ${colour}` }),\r\n\t\t\t\tspan({ class: \"name\" }, new Text(name)),\r\n\t\t\t\tnew Text(\": \"),\r\n\t\t\t\tspan({ class: \"value\" }, new Text(value.text)),\r\n\t\t\t))\r\n\t\t}\r\n\t}\r\n}\r\n\r\ncustomElements.define(\"svg-popup\", PopupElement)\r\n","import { div, span } from \"./util/html\"\n\nexport default class LegendElement extends HTMLElement {\n\tlines: { name: string, colour: string }[]\n\tdisabled: Set<string> = new Set()\n\n\tconstructor(private callback: () => void) {\n\t\tsuper()\n\t}\n\n\tupdate(data: { name: string, colour: string }[]) {\n\t\tthis.lines = data\n\t\tthis.innerHTML = \"\"\n\t\tfor (const { name, colour } of data) {\n\t\t\tconst legendItem = span({ class: \"legend-item\" },\n\t\t\t\tdiv({ class: \"swatch\", style: `background-color: ${colour}` }),\n\t\t\t\tspan({ class: \"name\" }, new Text(name)),\n\t\t\t)\n\t\t\tlegendItem.classList.toggle(\"disabled\", this.disabled.has(name))\n\t\t\tthis.appendChild(legendItem)\n\t\t\tlegendItem.addEventListener(\"click\", () => this.onLegendItemClick(name, legendItem))\n\t\t}\n\t}\n\n\tprivate onLegendItemClick(name: string, legendItem: HTMLElement) {\n\t\tif (this.disabled.has(name)) this.disabled.delete(name)\n\t\telse this.disabled.add(name)\n\t\tlegendItem.classList.toggle(\"disabled\", this.disabled.has(name))\n\t\tthis.callback()\n\t}\n}\n\ncustomElements.define(\"svg-legend\", LegendElement)\n","import Range from \"./util/range\"\nimport { Value } from \"./util/util\"\n\nexport abstract class Label implements Value {\n\tabstract value: Value\n\tabstract get text(): string\n\tabstract get axisType(): { new(range: Range<any>): Axis<Label> }\n\tvalueOf() { return this.value.valueOf() }\n}\n\nexport abstract class Axis<L extends Label> {\n\tconstructor(public range: Range<L>) { }\n\tabstract getTicks(n: number): L[]\n}\n","import { Axis, Label } from \"../label\"\nimport Range from \"../util/range\"\nimport { Value } from \"../util/util\"\n\nexport class EmptyLabel extends Label {\n\tvalue: Value = { valueOf: () => 0 }\n\tconstructor() { super() }\n\n\tget text() { return \"\" }\n\tget axisType() { return EmptyAxis }\n}\n\nexport class EmptyAxis extends Axis<EmptyLabel> {\n\tstatic RANGE = new Range(new EmptyLabel(), new EmptyLabel())\n\tconstructor(_range?: Range<Label>) { super(EmptyAxis.RANGE) }\n\n\tgetTicks(_n: number): EmptyLabel[] {\n\t\treturn [new EmptyLabel()]\n\t}\n}\n","import { Axis, Label } from \"../label\"\nimport { floorTo } from \"../util/util\"\n\nexport class NumberLabel extends Label {\n\tconstructor(public value: number) { super() }\n\n\tget text() { return this.value.toString() }\n\tget axisType() { return NumberAxis }\n}\n\nexport class NumberAxis extends Axis<NumberLabel> {\n\tgetTicks(n: number): NumberLabel[] {\n\t\tconst magnitude = Math.pow(10, Math.floor(Math.log10(this.range.span / n)) - 1)\n\t\tconst interval = floorTo(this.range.span / n, magnitude)\n\n\t\treturn [...Array(Math.floor(this.range.span / interval) + 1).keys().map(x =>\n\t\t\tnew NumberLabel(floorTo(x * interval + this.range.min.valueOf(), magnitude))\n\t\t)].filter((value, i, arr) => i == 0 || value.valueOf() != arr[i - 1].valueOf())\n\t}\n}\n","import { Axis, Label } from \"../label\"\nimport { floorTo } from \"../util/util\"\n\nexport class IntegerLabel extends Label {\n\tconstructor(public value: number) { super(); this.value = Math.floor(value) }\n\n\tget text() { return this.value.toString() }\n\tget axisType() { return IntegerAxis }\n}\n\nexport class IntegerAxis extends Axis<IntegerLabel> {\n\tgetTicks(n: number): IntegerLabel[] {\n\t\tconst magnitude = Math.max(1, Math.pow(10, Math.floor(Math.log10(this.range.span / n)) - 1))\n\t\tconst interval = floorTo(this.range.span / n, magnitude)\n\n\t\treturn [...Array(Math.floor(this.range.span / interval) + 1).keys().map(x =>\n\t\t\tnew IntegerLabel(x * interval + this.range.min.valueOf())\n\t\t)].filter((value, i, arr) => i == 0 || value.valueOf() != arr[i - 1].valueOf())\n\t}\n}\n","import { Axis, Label } from \"../label\"\n\nexport class DateLabel extends Label {\n\tconstructor(public value: Date) { super() }\n\n\tget text() { return this.value.toISOString().split(\"T\")[0] }\n\tget axisType() { return DateAxis }\n}\n\nexport class DateAxis extends Axis<DateLabel> {\n\tgetTicks(n: number): DateLabel[] {\n\t\t// total span in number of days\n\t\tconst span = this.range.span / 24 / 60 / 60 / 1000\n\n\t\tconst unitOffset = (span / 30 > n)\n\t\t\t? 30 // \"months\"\n\t\t\t: (span / 7 > n)\n\t\t\t\t? 7 // weeks\n\t\t\t\t: 1 // days\n\n\t\tconst interval = Math.ceil(span / unitOffset / n) * unitOffset\n\n\t\treturn [...Array(Math.floor(span / interval) + 1).keys().map(x =>\n\t\t\tnew DateLabel(new Date(x * interval * 24 * 60 * 60 * 1000 + this.range.min.valueOf()))\n\t\t)]\n\t}\n}\n","import { Axis, Label } from \"../label\"\n\nexport class TimeLabel extends Label {\n\tconstructor(public value: number) { super() }\n\n\tget text() {\n\t\tconst date = new Date(this.value * 1000)\n\t\tconst d = Math.floor(this.value / 24 / 60 / 60)\n\t\tconst h = date.getUTCHours()\n\t\tconst m = date.getUTCMinutes()\n\t\tconst s = date.getUTCSeconds() + date.getUTCMilliseconds() / 1000\n\t\tif (h > 0 || d > 0) {\n\t\t\tif (m == 0) return `${h + d * 24} h`\n\t\t\telse return `${h + d * 24}:${String(m).padStart(2, \"0\")} h`\n\t\t} else if (m > 0) {\n\t\t\treturn `${m}:${String(Math.floor(s)).padStart(2, \"0\")}`\n\t\t} else {\n\t\t\treturn `${s} s`\n\t\t}\n\t}\n\tget axisType() { return TimeAxis }\n}\n\nexport class TimeAxis extends Axis<TimeLabel> {\n\tgetTicks(n: number): TimeLabel[] {\n\t\tconst unitOffset = (this.range.span / 24 / 60 / 60 > n)\n\t\t\t? 24 * 60 * 60 // days\n\t\t\t: (this.range.span / 60 / 60 > n)\n\t\t\t\t? 60 * 60 // hours\n\t\t\t\t: (this.range.span / 60 > n)\n\t\t\t\t\t? 60 // minutes\n\t\t\t\t\t: 1 // seconds\n\n\t\tconst interval = Math.ceil(this.range.span / unitOffset / n) * unitOffset\n\n\t\treturn [...Array(Math.floor(this.range.span / interval) + 1).keys().map(x =>\n\t\t\tnew TimeLabel(x * interval + this.range.min.valueOf())\n\t\t)]\n\t}\n}\n","import { Axis, Label } from \"../label\"\n\nexport class MetricLabel extends Label {\n\tconstructor(public value: number, public unit: string) { super() }\n\n\tget text() {\n\t\tconst offset = MetricLabel.largestOffset(this.value)\n\t\treturn `${Math.floor(this.value / Math.pow(10, offset * 3))} ${MetricLabel.units[offset + MetricLabel.unitsStartOffset]}${this.unit}`\n\t}\n\tget axisType() { return MetricAxis }\n\n\tstatic units = [\"n\", \"u\", \"m\", \"\", \"k\", \"M\", \"G\", \"T\", \"P\", \"E\", \"Z\", \"Y\"]\n\tstatic unitsStartOffset = 3\n\n\tstatic largestOffset = (value: number): number =>\n\t\t(value == 0) ? 0 : Math.floor(Math.log10(value) / 3)\n}\n\nexport class MetricAxis extends Axis<MetricLabel> {\n\tgetTicks = (n: number): MetricLabel[] =>\n\t\t[...Array(n).keys().map(x => new MetricLabel(\n\t\t\tMath.floor(this.range.lerp(x / (n - 1))),\n\t\t\tthis.range.min.unit\n\t\t))]\n}\n","import { circle, g, line, polyline, rect, svg, text } from \"./util/svg\"\r\nimport { h1 } from \"./util/html\"\r\nimport Range from \"./util/range\"\r\nimport { DeepPartial, maxBy, maxByKey, minBy, minByKey, nearestLabel } from \"./util/util\"\r\nimport { Label, Axis } from \"./label\"\r\nimport PopupElement from \"./popup\"\r\nimport LegendElement from \"./legend\"\r\nimport { EmptyAxis, EmptyLabel } from \"./labeltypes/empty\"\r\n\r\nexport { Label } from \"./label\"\r\nexport { NumberLabel } from \"./labeltypes/number\"\r\nexport { IntegerLabel } from \"./labeltypes/integer\"\r\nexport { DateLabel } from \"./labeltypes/date\"\r\nexport { TimeLabel } from \"./labeltypes/time\"\r\nexport { MetricLabel } from \"./labeltypes/metric\"\r\nexport { EmptyLabel } from \"./labeltypes/empty\"\r\n\r\nexport type Point = { label: Label, value: Label }\r\n\r\nexport type Config = {\r\n\tdata: { [category: string]: Point[] }\r\n\tstyles?: DeepPartial<Styles>\r\n\ttitle?: string\r\n}\r\n\r\ntype AxisStyle = {\r\n\tcolour: string\r\n\tstrokeWidth: number\r\n\tlabels: {\r\n\t\tspacing: number\r\n\t\trotation: number\r\n\t\tcolour: string\r\n\t\tfontSize: string\r\n\t}\r\n}\r\n\r\nexport type Styles = {\r\n\tcolourscheme: string[]\r\n\txAxis: AxisStyle & { height: number }\r\n\tyAxis: AxisStyle & { width: number }\r\n\tgrid: {\r\n\t\tstroke: string\r\n\t}\r\n\tguideline: {\r\n\t\tstroke: string\r\n\t\twidth: number\r\n\t\tpoints: {\r\n\t\t\tr: number\r\n\t\t\tfill: string\r\n\t\t}\r\n\t}\r\n\tlines: {\r\n\t\twidth: number\r\n\t}\r\n}\r\n\r\nexport default class SVGraph extends HTMLElement {\r\n\tsvgElem: SVGElement\r\n\tpopupElem: PopupElement\r\n\tlegendElem: LegendElement\r\n\tguideElem: SVGElement\r\n\tselectionElem: SVGElement\r\n\r\n\tdata: { name: string, colour: string, points: Point[] }[]\r\n\tstyles: Styles\r\n\txaxis: Axis<Label>\r\n\tyaxis: Axis<Label>\r\n\r\n\tprivate resizeObserver: ResizeObserver\r\n\tprivate selection: { from?: number, to?: number } = {}\r\n\tprivate activeData: { name: string, colour: string, points: Point[] }[]\r\n\r\n\tget canvasCoordRange() { return new Range(this.styles.yAxis.width, this.svgElem.clientWidth) }\r\n\r\n\tconstructor(config: Config) {\r\n\t\tsuper()\r\n\r\n\t\tconst shadow = this.attachShadow({ mode: \"open\" })\r\n\r\n\t\tconst styleElem = document.createElement(\"style\")\r\n\t\tstyleElem.textContent = style\r\n\t\tshadow.appendChild(styleElem)\r\n\r\n\t\tshadow.appendChild(h1({ id: \"title\" }))\r\n\r\n\t\tthis.legendElem = new LegendElement(() => this.updateActiveData())\r\n\t\tshadow.appendChild(this.legendElem)\r\n\r\n\t\tthis.svgElem = svg({ width: \"100%\", height: \"100%\", overflow: \"visible\", fill: \"white\" })\r\n\t\tthis.svgElem.addEventListener(\"mousedown\", (event: MouseEvent) => this.onMouseDown(event))\r\n\t\tthis.svgElem.addEventListener(\"mouseup\", (event: MouseEvent) => this.onMouseUp(event))\r\n\t\tthis.svgElem.addEventListener(\"mousemove\", (event: MouseEvent) => this.onMouseMove(event))\r\n\t\tthis.svgElem.addEventListener(\"mouseleave\", (event: MouseEvent) => this.onMouseLeave(event))\r\n\t\tshadow.appendChild(this.svgElem)\r\n\r\n\t\tthis.popupElem = new PopupElement()\r\n\t\tshadow.appendChild(this.popupElem)\r\n\r\n\t\tthis.update(config, false)\r\n\t}\r\n\r\n\t// Callback for when the element is added to the DOM\r\n\tprivate connectedCallback() {\r\n\t\tthis.resizeObserver = new ResizeObserver((entries) => {\r\n\t\t\tconst { inlineSize: width, blockSize: height } = entries[0].contentBoxSize[0]\r\n\t\t\tif (width > 0 && height > 0) this.draw(width, height)\r\n\t\t})\r\n\t\tthis.resizeObserver.observe(this.svgElem, { box: \"content-box\" })\r\n\t}\r\n\r\n\tupdate({ data, title, styles }: Config, redraw = true) {\r\n\t\tthis.styles = {\r\n\t\t\tcolourscheme: styles?.colourscheme ?? [\"black\"],\r\n\t\t\txAxis: {\r\n\t\t\t\theight: styles?.xAxis?.height ?? 30,\r\n\t\t\t\tcolour: styles?.xAxis?.colour ?? \"white\",\r\n\t\t\t\tstrokeWidth: styles?.xAxis?.strokeWidth ?? 1,\r\n\t\t\t\tlabels: {\r\n\t\t\t\t\tspacing: styles?.xAxis?.labels?.spacing ?? 30,\r\n\t\t\t\t\trotation: styles?.xAxis?.labels?.rotation ?? 0,\r\n\t\t\t\t\tcolour: styles?.xAxis?.labels?.colour ?? styles?.xAxis?.colour ?? \"#FFF8\",\r\n\t\t\t\t\tfontSize: styles?.xAxis?.labels?.fontSize ?? \"0.8em\",\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tyAxis: {\r\n\t\t\t\twidth: styles?.yAxis?.width ?? 30,\r\n\t\t\t\tcolour: styles?.yAxis?.colour ?? \"white\",\r\n\t\t\t\tstrokeWidth: styles?.yAxis?.strokeWidth ?? 1,\r\n\t\t\t\tlabels: {\r\n\t\t\t\t\tspacing: styles?.yAxis?.labels?.spacing ?? 50,\r\n\t\t\t\t\trotation: styles?.yAxis?.labels?.rotation ?? 0,\r\n\t\t\t\t\tcolour: styles?.yAxis?.labels?.colour ?? styles?.yAxis?.colour ?? \"#FFF8\",\r\n\t\t\t\t\tfontSize: styles?.yAxis?.labels?.fontSize ?? \"0.8em\",\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tgrid: {\r\n\t\t\t\tstroke: styles?.grid?.stroke ?? \"#FFF2\",\r\n\t\t\t},\r\n\t\t\tguideline: {\r\n\t\t\t\tstroke: styles?.guideline?.stroke ?? \"#FFF8\",\r\n\t\t\t\twidth: styles?.guideline?.width ?? 1,\r\n\t\t\t\tpoints: {\r\n\t\t\t\t\tr: styles?.guideline?.points?.r ?? 2,\r\n\t\t\t\t\tfill: styles?.guideline?.points?.fill ?? \"white\",\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tlines: {\r\n\t\t\t\twidth: styles?.lines?.width ?? 2,\r\n\t\t\t},\r\n\t\t}\r\n\r\n\t\t// const a: Axis<Label> = new EmptyAxis()\r\n\r\n\t\tconst l: EmptyLabel = new EmptyLabel()\r\n\t\tl as Label\r\n\t\tconst r = new Range(l, l)\r\n\t\tr as Range<Label>\r\n\r\n\t\tthis.data = Object.entries(data)\r\n\t\t\t.sort((a, b) => (b[1].at(-1)?.value?.valueOf() ?? 0) - (a[1].at(-1)?.value?.valueOf() ?? 0))\r\n\t\t\t.map(([name, points], i, arr) => ({ name, points, colour: getColour(this.styles.colourscheme, (i + 1) / (arr.length + 1)) }))\r\n\r\n\t\tthis.xaxis = getAxis(this.data, \"label\")\r\n\t\tthis.yaxis = getAxis(this.data, \"value\")\r\n\t\tthis.legendElem.update(this.data)\r\n\r\n\t\tthis.shadowRoot.getElementById(\"title\").textContent = title\r\n\r\n\t\tthis.updateActiveData(redraw)\r\n\t}\r\n\r\n\tdraw(width: number, height: number) {\r\n\t\tthis.svgElem.innerHTML = \"\"\r\n\r\n\t\tthis.svgElem.appendChild(this.grid(this.styles.yAxis.width, 0, width - this.styles.yAxis.width, height - this.styles.xAxis.height))\r\n\t\tthis.svgElem.appendChild(this.lines(this.styles.yAxis.width, 0, width - this.styles.yAxis.width, height - this.styles.xAxis.height))\r\n\t\tthis.svgElem.appendChild(this.axes(0, 0, width, height))\r\n\r\n\t\tthis.guideElem = this.guide(height - this.styles.xAxis.height)\r\n\t\tthis.svgElem.appendChild(this.guideElem)\r\n\r\n\t\tthis.selectionElem = this.selectionOverlay(this.styles.yAxis.width, 0, width - this.styles.yAxis.width, height - this.styles.xAxis.height)\r\n\t\tthis.svgElem.appendChild(this.selectionElem)\r\n\t}\r\n\r\n\tselectRange(from: Label, to: Label, redraw = true) {\r\n\t\tthis.xaxis.range = new Range(from, to)\r\n\t\tthis.updateActiveData(false)\r\n\r\n\t\tif (this.activeData.length == 0) {\r\n\t\t\t// selection has no data, reset zoom\r\n\t\t\tthis.xaxis = getAxis(this.data, \"label\")\r\n\t\t\tthis.updateActiveData(false)\r\n\t\t}\r\n\r\n\t\tif (redraw) this.draw(this.svgElem.clientWidth, this.svgElem.clientHeight)\r\n\t}\r\n\r\n\tprivate updateActiveData(redraw = true) {\r\n\t\tconst newActiveData = this.data\r\n\t\t\t.filter(({ name }) => !this.legendElem.disabled.has(name))\r\n\t\t\t.map(({ name, colour, points }) => ({\r\n\t\t\t\tname, colour, points: points.filter(({ label }, i, arr) =>\r\n\t\t\t\t\tthis.xaxis.range.contains(label)\r\n\t\t\t\t\t|| (arr[i - 1] && this.xaxis.range.contains(arr[i - 1].label))\r\n\t\t\t\t\t|| (arr[i + 1] && this.xaxis.range.contains(arr[i + 1].label))\r\n\t\t\t\t)\r\n\t\t\t})).filter(({ points }) => points.length > 0)\r\n\r\n\t\tthis.activeData = newActiveData\r\n\r\n\t\tthis.yaxis = getAxis(this.activeData, \"value\")\r\n\r\n\t\tif (redraw) this.draw(this.svgElem.clientWidth, this.svgElem.clientHeight)\r\n\t}\r\n\r\n\tprivate axes(x: number, y: number, width: number, height: number): SVGElement {\r\n\t\treturn g({ class: \"axes\", transform: `translate(${x}, ${y})` },\r\n\t\t\tthis.xAxis(this.styles.yAxis.width, height - this.styles.xAxis.height, width - this.styles.yAxis.width, this.styles.xAxis.height),\r\n\t\t\tthis.yAxis(0, 0, this.styles.yAxis.width, height - this.styles.xAxis.height)\r\n\t\t)\r\n\t}\r\n\r\n\tprivate xAxis = (x: number, y: number, width: number, height: number): SVGElement =>\r\n\t\tg({ class: \"xaxis\" },\r\n\t\t\tline({\r\n\t\t\t\tfrom: [x - this.styles.yAxis.strokeWidth, y + this.styles.xAxis.strokeWidth / 2],\r\n\t\t\t\tto: [x + width, y + this.styles.xAxis.strokeWidth / 2],\r\n\t\t\t\tstroke: this.styles.xAxis.colour,\r\n\t\t\t\t\"stroke-width\": this.styles.xAxis.strokeWidth\r\n\t\t\t}),\r\n\t\t\t...this.xaxis.getTicks(Math.floor(width / this.styles.xAxis.labels.spacing)).map(step => text({\r\n\t\t\t\tclass: \"tick-label\",\r\n\t\t\t\tx: x + this.xaxis.range.normalize(step) * width,\r\n\t\t\t\ty: y + 20,\r\n\t\t\t\ttransform: `rotate(${this.styles.xAxis.labels.rotation})`,\r\n\t\t\t\t\"text-anchor\": textAnchorForLabelRotation(this.styles.xAxis.labels.rotation),\r\n\t\t\t\tstyle: `transform-origin: ${transformOriginForLabelRotation(this.styles.xAxis.labels.rotation)}`,\r\n\t\t\t\tfill: this.styles.xAxis.labels.colour,\r\n\t\t\t\t\"font-size\": this.styles.xAxis.labels.fontSize,\r\n\t\t\t}, new Text(step.text)))\r\n\t\t)\r\n\r\n\tprivate yAxis = (x: number, y: number, width: number, height: number): SVGElement =>\r\n\t\tg({ class: \"yaxis\" },\r\n\t\t\tline({\r\n\t\t\t\tfrom: [x + width - this.styles.yAxis.strokeWidth / 2, y],\r\n\t\t\t\tto: [x + width - this.styles.yAxis.strokeWidth / 2, y + height],\r\n\t\t\t\tstroke: this.styles.yAxis.colour,\r\n\t\t\t\t\"stroke-width\": this.styles.yAxis.strokeWidth\r\n\t\t\t}),\r\n\t\t\t...this.yaxis.getTicks(Math.floor(height / this.styles.yAxis.labels.spacing)).map(step => text({\r\n\t\t\t\tclass: \"tick-label\",\r\n\t\t\t\tx: x + width - 10,\r\n\t\t\t\ty: y + (1 - this.yaxis.range.normalize(step)) * height + 5,\r\n\t\t\t\ttransform: `rotate(${this.styles.yAxis.labels.rotation})`,\r\n\t\t\t\t\"text-anchor\": \"end\",\r\n\t\t\t\tstyle: \"transform-origin: right\",\r\n\t\t\t\tfill: this.styles.yAxis.labels.colour,\r\n\t\t\t\t\"font-size\": this.styles.yAxis.labels.fontSize,\r\n\t\t\t}, new Text(step.text)))\r\n\t\t)\r\n\r\n\tprivate grid = (x: number, y: number, width: number, height: number): SVGElement =>\r\n\t\tg({ class: \"grid\", transform: `translate(${x}, ${y})` },\r\n\t\t\t...this.xaxis.getTicks(Math.floor(width / this.styles.xAxis.labels.spacing)).map(step => line({\r\n\t\t\t\tclass: \"gridline-v\",\r\n\t\t\t\tfrom: [this.xaxis.range.normalize(step) * width, 0],\r\n\t\t\t\tto: [this.xaxis.range.normalize(step) * width, height],\r\n\t\t\t\tstroke: this.styles.grid.stroke\r\n\t\t\t})),\r\n\t\t\t...this.yaxis.getTicks(Math.floor(height / this.styles.yAxis.labels.spacing)).map(step => line({\r\n\t\t\t\tclass: \"gridline-h\",\r\n\t\t\t\tfrom: [0, (1 - this.yaxis.range.normalize(step)) * height],\r\n\t\t\t\tto: [width, (1 - this.yaxis.range.normalize(step)) * height],\r\n\t\t\t\tstroke: this.styles.grid.stroke\r\n\t\t\t})),\r\n\t\t)\r\n\r\n\tprivate lines = (x: number, y: number, width: number, height: number): SVGElement =>\r\n\t\tg({ class: \"lines\", transform: `translate(${x}, ${y})`, \"stroke-width\": this.styles.lines.width },\r\n\t\t\t...this.activeData.map(({ name, colour, points: values }, i) => {\r\n\t\t\t\tconst points = values.map(point => [\r\n\t\t\t\t\tRange.UNIT.clamp(this.xaxis.range.normalize(point.label)) * width,\r\n\t\t\t\t\tRange.UNIT.clamp((1 - this.yaxis.range.normalize(point.value))) * height,\r\n\t\t\t\t] as [number, number])\r\n\t\t\t\treturn polyline({ \"data-name\": name, points, fill: \"none\", stroke: colour })\r\n\t\t\t})\r\n\t\t)\r\n\r\n\tprivate selectionOverlay = (x: number, y: number, width: number, height: number): SVGElement =>\r\n\t\trect({ class: \"selection-overlay\", x: x, y: y, width: 0, height: height, fill: \"#46A4\" })\r\n\r\n\tprivate guide = (height: number): SVGElement =>\r\n\t\tg({ class: \"guide\", transform: `translate(${this.styles.yAxis.width}, 0)`, visibility: \"hidden\" },\r\n\t\t\tline({ class: \"guideline\", from: [0, 0], to: [0, height], stroke: this.styles.guideline.stroke, \"stroke-width\": this.styles.guideline.width }),\r\n\t\t\t...this.activeData.map(() => circle({ class: \"guide-point\", cx: 0, cy: 0, r: this.styles.guideline.points.r, fill: this.styles.guideline.points.fill })),\r\n\t\t)\r\n\r\n\tprivate onMouseDown(event: MouseEvent) {\r\n\t\tif (this.isWithinGraphArea(event.clientX, event.clientY)) {\r\n\t\t\tthis.selection = { from: Range.UNIT.clamp(this.canvasCoordRange.normalize(event.clientX - this.svgElem.getBoundingClientRect().left)) }\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onMouseUp(event: MouseEvent) {\r\n\t\tif (this.selection.from != undefined) {\r\n\t\t\tthis.selectRange(\r\n\t\t\t\tnearestLabel(Math.min(this.selection.from, this.selection.to), this.xaxis.range, this.activeData),\r\n\t\t\t\tnearestLabel(Math.max(this.selection.from, this.selection.to), this.xaxis.range, this.activeData)\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\tthis.selection = {}\r\n\t\tthis.selectionElem.setAttribute(\"width\", \"0\")\r\n\t}\r\n\r\n\tprivate onMouseMove(event: MouseEvent) {\r\n\t\tconst svgRect = this.svgElem.getBoundingClientRect()\r\n\t\tconst shadowRect = this.shadowRoot.host.getBoundingClientRect()\r\n\t\tconst t = this.canvasCoordRange.normalize(event.clientX - svgRect.left)\r\n\r\n\t\tif (this.isWithinGraphArea(event.clientX, event.clientY)) {\r\n\t\t\tthis.handleSelection(t, event.buttons)\r\n\t\t\tthis.handleHover(t, event.clientX - shadowRect.left, event.clientY - shadowRect.top, svgRect)\r\n\t\t} else {\r\n\t\t\tthis.popupElem.hide()\r\n\t\t\tthis.guideElem.setAttribute(\"visibility\", \"hidden\")\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onMouseLeave(event: MouseEvent) {\r\n\t\tthis.popupElem.hide()\r\n\t\tthis.guideElem.setAttribute(\"visibility\", \"hidden\")\r\n\t}\r\n\r\n\tprivate handleSelection(t: number, buttons: number) {\r\n\t\tif ((buttons & 1) == 1) {\r\n\t\t\t// primary (left) mouse button pressed\r\n\t\t\tthis.selection.to = Range.UNIT.clamp(t)\r\n\t\t} else {\r\n\t\t\tthis.selection = {}\r\n\t\t}\r\n\r\n\t\tif (this.selection.from != undefined && this.selection.to != undefined) {\r\n\t\t\tthis.selectionElem.setAttribute(\"x\", this.canvasCoordRange.lerp(Math.min(this.selection.from, this.selection.to)).toString())\r\n\t\t\tthis.selectionElem.setAttribute(\"width\", (this.canvasCoordRange.lerp(Math.abs(this.selection.to - this.selection.from)) - this.styles.yAxis.width).toString())\r\n\t\t} else {\r\n\t\t\tthis.selectionElem.setAttribute(\"width\", \"0\")\r\n\t\t}\r\n\t}\r\n\r\n\tprivate handleHover(t: number, x: number, y: number, rect: DOMRect) {\r\n\t\tconst points = this.popupElem.update(x, y, t, this.xaxis.range, this.activeData)\r\n\r\n\t\tthis.guideElem.querySelectorAll(\".guide-point\").forEach((point, i) => {\r\n\t\t\tpoint.setAttribute(\"cy\", ((1 - this.yaxis.range.normalize(points[i].value)) * (rect.height - this.styles.xAxis.height)).toString())\r\n\t\t})\r\n\r\n\t\tthis.guideElem.setAttribute(\"transform\", `translate(${x}, 0)`)\r\n\t\tthis.guideElem.removeAttribute(\"visibility\")\r\n\t}\r\n\r\n\tprivate isWithinGraphArea(x: number, y: number): boolean {\r\n\t\tconst rect = this.svgElem.getBoundingClientRect()\r\n\t\treturn new Range(rect.left + this.styles.yAxis.width, rect.right).contains(x)\r\n\t\t\t&& new Range(rect.top, rect.bottom - this.styles.xAxis.height).contains(y)\r\n\t}\r\n}\r\n\r\ncustomElements.define(\"svg-graph\", SVGraph)\r\n\r\nconst textAnchorForLabelRotation = (rotation: number): \"start\" | \"middle\" | \"end\" =>\r\n\trotation < 0 ? \"end\" : rotation > 0 ? \"start\" : \"middle\"\r\n\r\nconst transformOriginForLabelRotation = (rotation: number): \"left\" | \"center\" | \"right\" =>\r\n\trotation < 0 ? \"right\" : rotation > 0 ? \"left\" : \"center\"\r\n\r\nconst getColour = (colourscheme: string[], i: number) => colourscheme[Math.floor(i * colourscheme.length)]\r\n\r\nfunction getAxis(data: { name: string, colour: string, points: Point[] }[], key: keyof Point): Axis<Label> {\r\n\tconst dataFiltered = data.filter(({ points }) => points.length > 0)\r\n\tif (dataFiltered.length == 0) return new EmptyAxis()\r\n\r\n\tconst range = new Range(\r\n\t\tminBy(dataFiltered.map(({ points }) => minBy(points, p => p[key].valueOf())?.[key]), l => l.valueOf()),\r\n\t\tmaxBy(dataFiltered.map(({ points }) => maxBy(points, p => p[key].valueOf())?.[key]), l => l.valueOf()),\r\n\t)\r\n\r\n\treturn new range.min.axisType(range)\r\n}\r\n\r\nconst style = `\r\n:host {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\theight: 100%;\r\n}\r\n:host([hidden]) {\r\n\tdisplay: none;\r\n}\r\n\r\nh1 {\r\n\tmargin: 0 0 0.5em 0;\r\n\tfont-size: 1.5em;\r\n\ttext-align: center;\r\n}\r\nh1:empty {\r\n\tdisplay: none;\r\n}\r\n\r\nsvg-popup {\r\n\tposition: absolute;\r\n\tpadding: 0.5em 0.6em;\r\n\twhite-space: nowrap;\r\n\tbackground: #2228;\r\n\tborder: 1px solid #FFF1;\r\n\tborder-radius: 10px;\r\n\tbox-shadow: 1px 2px 20px 0px #0008;\r\n\tbackdrop-filter: blur(20px);\r\n\tpointer-events: none; // prevent fast mouse movements from triggering mouseleave on svg\r\n}\r\nsvg-popup h3 {\r\n\tmargin: 0 0 0.6em 0;\r\n}\r\nsvg-popup p {\r\n\tmargin: 0.3em 0 0 0;\r\n}\r\nsvg-popup .name {\r\n\tfont-family: monospace;\r\n\tfont-size: 1.2em;\r\n\tfont-weight: bold;\r\n}\r\n\r\nsvg-legend {\r\n\tdisplay: flex;\r\n\tflex-wrap: wrap;\r\n\tjustify-content: center;\r\n\tmargin: 5px;\r\n}\r\nsvg-legend .legend-item {\r\n\tpadding: 0.25em 0.6em;\r\n\tborder: 1px solid transparent;\r\n\tborder-radius: 1em;\r\n}\r\nsvg-legend .legend-item:hover {\r\n\tbackground: #FFF1;\r\n\tborder: 1px solid #FFF1;\r\n\tbox-shadow: 1px 2px 5px 0px #0004;\r\n\tbackdrop-filter: blur(20px);\r\n\tcursor: pointer;\r\n}\r\nsvg-legend .legend-item.disabled {\r\n\topacity: 0.5;\r\n\ttext-decoration: line-through;\r\n}\r\n\r\n.swatch {\r\n\tdisplay: inline-block;\r\n\twidth: 0.75em;\r\n\theight: 0.75em;\r\n\tmargin-right: 0.5em;\r\n\tborder-radius: 50%;\r\n}\r\n\t\r\n.xaxis text, .yaxis text {\r\n\ttransform-box: fill-box;\r\n}`\r\n"],"names":["ns","element","name","attrs","children","elem","document","createElementNS","key","undefined","setAttribute","child","appendChild","g","line","x1","from","y1","x2","to","y2","text","createElement","div","p","span","Range","min","max","constructor","this","static","valueOf","contains","value","clamp","Math","normalize","lerp","t","maxBy","arr","fn","length","reduce","a","b","minBy","minByKey","floorTo","n","floor","nearestLabel","range","data","nearestLabelsIdx","map","points","nearestIdx","label","x","idx","abs","nearestLabels","closestIdx","i","l","nearestPointForLabel","PopupElement","HTMLElement","super","show","removeAttribute","hide","move","y","style","left","top","update","innerHTML","h3","Text","nearestPoints","colour","point","setValues","class","customElements","define","LegendElement","callback","lines","disabled","Set","legendItem","classList","toggle","has","addEventListener","onLegendItemClick","delete","add","Label","Axis","EmptyLabel","axisType","EmptyAxis","_range","RANGE","getTicks","_n","NumberLabel","toString","NumberAxis","magnitude","pow","log10","interval","Array","keys","filter","IntegerLabel","IntegerAxis","DateLabel","toISOString","split","DateAxis","unitOffset","ceil","Date","TimeLabel","date","d","h","getUTCHours","m","getUTCMinutes","s","getUTCSeconds","getUTCMilliseconds","String","padStart","TimeAxis","MetricLabel","unit","offset","largestOffset","units","unitsStartOffset","MetricAxis","SVGraph","svgElem","popupElem","legendElem","guideElem","selectionElem","styles","xaxis","yaxis","resizeObserver","selection","activeData","canvasCoordRange","yAxis","width","clientWidth","config","shadow","attachShadow","mode","styleElem","textContent","h1","id","updateActiveData","xmlns","svg","height","overflow","fill","event","onMouseDown","onMouseUp","onMouseMove","onMouseLeave","connectedCallback","ResizeObserver","entries","inlineSize","blockSize","contentBoxSize","draw","observe","box","title","redraw","colourscheme","xAxis","strokeWidth","labels","spacing","rotation","fontSize","grid","stroke","guideline","r","Object","sort","at","getColour","getAxis","shadowRoot","getElementById","axes","guide","selectionOverlay","selectRange","clientHeight","newActiveData","transform","step","textAnchorForLabelRotation","transformOriginForLabelRotation","values","join","polyline","UNIT","rect","visibility","circle","cx","cy","isWithinGraphArea","clientX","clientY","getBoundingClientRect","svgRect","shadowRect","host","handleSelection","buttons","handleHover","querySelectorAll","forEach","right","bottom","dataFiltered"],"mappings":"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"}